\setupcolors[state=start]
\setupinteraction[state=start, color=blue]
\setuppagenumbering[state=stop]

\setupbodyfont[10pt]

\setupwhitespace[medium]

\setuppapersize[A4]

% 图片
\setupcaptions[prefix=yes, way=bychapter, prefixsegments=chapter]
\setupexternalfigures[directory={./figures/ch1, ./figures/ch2, ./figures/ch3, ./figures/ch4, ./figures/ch5}]

% 设置标题
\setupheads[style=bold]
\setuphead[chapter][after=\noheaderandfooterlines]
\setuplabeltext[chapter=Chapter~]

% 设置目录
\setuplist[chapter][width=fit, distance=1em]
\setuplist[section][margin=2em, width=fit, distance=1em]
\setuplist[subsection][margin=4em, width=fit, distance=1em]

% 设置代码环境
\setupnarrower[left=2em]
\definetyping[code][escape=yes,
                    before={\startnarrower[left]},
                    after={\stopnarrower}]

% 练习，答案
\defineenumeration[exercise][alternative=serried,
                             headstyle=bold,
                             way=bychapter,
                             prefix=chapter,
                             text=Exercise,
                             right=.,
                             width=fit]
\defineenumeration[answer][alternative=serried,
                           headstyle=bold,
                           way=bychapter,
                           prefix=chapter,
                           text=Solution,
                           ritht=:,
                           width=fit]
\defineblock[exercise]
\keepblocks[exercise]
\setupblock[exercise][before=\startexercise,
                      after=\stopexercise]
\defineblock[answer]
\hideblocks[answer]
\setupblock[answer][before=\startanswer,
                    after=\stopanswer]

% 设置页眉
\startsectionblockenvironment[frontpart]
    \setupuserpagenumber[numberconversion=Romannumerals]
    \setupheadertexts[]
                     [{\userpagenumber}]
                     []
                     [{\userpagenumber}]
\stopsectionblockenvironment

\startsectionblockenvironment[bodypart]
    \resetpagenumber
    \setupheadertexts[{Chapter~\headnumber[chapter] \getmarking[chapter]}]
                     [{\pagenumber}]
                     [{\headnumber[section] \getmarking[section]}]
                     [{\pagenumber}]
\stopsectionblockenvironment

% 段落中表达式
\def\exp#1{\color[blue]{\type{#1}}}

% 指出需进一步修改内容，内容独立成段
\def\fixme#1{\startframedtext[width=\textwidth,
                              background=color,
                              backgroundcolor=darkgray,
                              corner=round]
             \color[red]{Fixme:}~~#1\par
             \stopframedtext}

% 指出需修改内容，内容嵌入段落
\def\infixme#1{\inframed[background=color,
                         backgroundcolor=darkgray,
                         corner=round]
                  {\color[red]{Fixme:}~~#1}}

% 指出尚未添加内容
\def\todo#1{\startframedtext[width=\textwidth,
                             background=color,
                             backgroundcolor=yellow,
                             corner=round]
               \color[red]{Todo:}~~#1\par
            \stopframedtext}
